import{u as W,a as B,a6 as G,f as J,e as K,j as e,B as C,n as R,l as c,bR as h,E as X,a9 as _,a5 as I,aa as P,ab as D,ac as m,bS as O,aJ as Z,i as N,bT as z,bU as q,a8 as L,p as V,bV as ee,bW as re,bX as te,s as oe,ax as ie,r as b,bY as ne,ay as ae,az as se,aA as de,aB as le,aC as j,aD as ce,bZ as ue,b_ as pe,b$ as l,T as Y,m as ge,D as he}from"./index-DthS9im-.js";import{g as S}from"./groupByKey-nGMiMvM1.js";import{S as xe}from"./SearchIcon-Ch7TZ4TL.js";import{C as me}from"./Clear-AvwY9pTL.js";import{A as be}from"./Autocomplete-BOeus3py.js";import{A as fe,a as je,C as ye}from"./ArrowDropUp-gkW-b1fr.js";import{L as Ce}from"./ListItemButton-B7z4uBec.js";import"./usePreviousProps-sMvt-2hG.js";const ke=()=>{const i=W(),{rgn_id:t,ctrl_id:d,date:a,states:u,priority:p,controllerSearch:x}=B(r=>r.ticketStore),f=B(r=>r.authStore),{isSuccess:n,data:s,isLoading:w}=G(),F=J(),M=K(),k=()=>{var r;F(((r=f.user)==null?void 0:r.rl_id)===te.Invitado?"/invitado/ticket/create":"/ticket/create",{state:{from:M.pathname}})},g=r=>{i(h({rgn_id:r.target.value,ctrl_id:void 0}))},T=r=>{i(h({ctrl_id:r.target.value}))},H=r=>{i(h({priority:r.target.value}))},U=r=>{typeof r.target.value=="object"&&i(h({states:[...r.target.value]}))};return e.jsx(e.Fragment,{children:e.jsx(C,{sx:{width:"100%"},children:e.jsx(R,{sx:{maxWidth:"100%",height:"100%"},children:e.jsxs(c,{direction:"row",spacing:1,alignItems:"center",justifyContent:"space-between",paddingBottom:1.5,children:[e.jsxs(c,{direction:"row",spacing:1,alignItems:"center",height:"auto",children:[e.jsx(c,{spacing:2,sx:{width:250},children:e.jsx(be,{freeSolo:!0,value:x,onChange:(r,o)=>{typeof o!="string"&&i(h({controllerSearch:o,rgn_id:o?String(o.rgn_id):void 0,ctrl_id:o?String(o.ctrl_id):void 0}))},clearIcon:e.jsx(me,{onClick:()=>{i(h({controllerSearch:null}))}}),id:"controller_ticket_searcher",options:n&&s?s:[],getOptionLabel:r=>typeof r=="string"?r:r.nodo,sx:{width:250},renderInput:r=>e.jsx(X,{...r,placeholder:"Buscar sitio",disabled:w,slotProps:{input:{...r.InputProps,startAdornment:e.jsx(xe,{})}},sx:{"& .MuiOutlinedInput-root":{borderRadius:"25px",px:2}}})})}),e.jsxs(c,{spacing:1,width:200,direction:"row",alignItems:"center",children:[e.jsx(_,{htmlFor:"group_site",sx:{display:"none"},children:"Grupo de sitio"}),e.jsxs(I,{displayEmpty:!0,value:t??"",onChange:g,inputProps:{id:"group_site"},renderValue:r=>{if(r.length===0)return e.jsx(e.Fragment,{children:"Grupo de sitio"});let o;return n&&(o=S(s,"rgn_id")[r]?S(s,"rgn_id")[r][0]:void 0),e.jsx(e.Fragment,{children:o==null?void 0:o.region.region})},IconComponent:({...r})=>t?e.jsx(P,{onClick:o=>{o.stopPropagation(),i(h({rgn_id:void 0,ctrl_id:void 0}))}}):e.jsx(D,{...r}),sx:{width:200,borderRadius:"10px",backgroundColor:"transparent","&.Mui-focused":{boxShadow:"none"},"&.MuiOutlinedInput-root":{fontWeight:500,backgroundColor:"transparent",color:"text.primary","& fieldset":{...t&&{backgroundColor:"tertiary.opacityLight"},borderColor:"custom.outlineBoder"},"&:hover fieldset":{backgroundColor:"tertiary.opacityLight",borderColor:"custom.outlineBoder"},"&.Mui-focused fieldset":{borderColor:"custom.outlineBoder",backgroundColor:"tertiary.opacityLight"}},"& .MuiSelect-icon":{color:"text.primary"}},MenuProps:{PaperProps:{style:{maxHeight:200,width:200}}},children:[e.jsx(m,{disabled:!0,value:"",children:e.jsx(e.Fragment,{children:"Grupo de sitio"})}),n&&Object.entries(S(s,"rgn_id")).map(([r,o])=>e.jsx(m,{value:r,children:e.jsx(C,{sx:{overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis",width:"100%"},children:o[0].region.region})},r))]})]}),e.jsxs(c,{spacing:1,width:200,direction:"row",alignItems:"center",children:[e.jsx(_,{htmlFor:"site_item",sx:{display:"none"},children:"Sitio"}),e.jsxs(I,{disabled:!t,displayEmpty:!0,value:d??"",onChange:T,inputProps:{id:"site_item"},renderValue:r=>{if(r.length===0)return e.jsx(e.Fragment,{children:"Sitio"});let o;return n&&(o=s.find(v=>String(v.ctrl_id)===String(r))),e.jsx(e.Fragment,{children:o==null?void 0:o.nodo})},IconComponent:({...r})=>d?e.jsx(P,{onClick:o=>{o.stopPropagation(),i(h({ctrl_id:void 0}))}}):e.jsx(D,{...r}),sx:{width:200,borderRadius:"10px",backgroundColor:"transparent","&.Mui-focused":{boxShadow:"none"},"&.MuiOutlinedInput-root":{fontWeight:500,backgroundColor:"transparent",color:"text.primary","& fieldset":{...t&&{backgroundColor:"tertiary.opacityLight"},borderColor:"custom.outlineBoder"},"&:hover fieldset":{backgroundColor:"tertiary.opacityLight",borderColor:"custom.outlineBoder"},"&.Mui-focused fieldset":{borderColor:"custom.outlineBoder",backgroundColor:"tertiary.opacityLight"}},"& .MuiSelect-icon":{color:"text.primary"}},MenuProps:{PaperProps:{style:{maxHeight:200,width:200}}},children:[e.jsx(m,{disabled:!0,value:"",children:e.jsx(e.Fragment,{children:"Sitio"})}),n&&t&&S(s,"rgn_id")[t]&&S(s,"rgn_id")[t].map(r=>e.jsx(m,{value:String(r.ctrl_id),children:e.jsx(C,{sx:{overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis",width:"100%"},children:r.nodo})},String(r.ctrl_id)))]})]}),e.jsxs(c,{spacing:1,width:200,direction:"row",alignItems:"center",children:[e.jsx(_,{htmlFor:"multiple_state_select",sx:{display:"none"},children:"Estados"}),e.jsxs(I,{displayEmpty:!0,value:u,multiple:!0,onChange:U,inputProps:{id:"multiple_state_select"},renderValue:r=>{if(r.length===0)return e.jsx(e.Fragment,{children:"Estados"});const o=r.reduce((v,$)=>{const A=v,E=O.find(Q=>String(Q.value)===String($));return E&&A.push(E.name),A},[]);return e.jsx(e.Fragment,{children:o.join(", ")})},IconComponent:({...r})=>u.length>0?e.jsx(P,{onClick:o=>{o.stopPropagation(),i(h({states:[]}))}}):e.jsx(D,{...r}),sx:{width:200,borderRadius:"10px",backgroundColor:"transparent","&.Mui-focused":{boxShadow:"none"},"&.MuiOutlinedInput-root":{fontWeight:500,backgroundColor:"transparent",color:"text.primary","& fieldset":{...u.length>0&&{backgroundColor:"tertiary.opacityLight"},borderColor:"custom.outlineBoder"},"&:hover fieldset":{backgroundColor:"tertiary.opacityLight",borderColor:"custom.outlineBoder"},"&.Mui-focused fieldset":{borderColor:"custom.outlineBoder",backgroundColor:"tertiary.opacityLight"}},"& .MuiSelect-icon":{color:"text.primary"}},MenuProps:{PaperProps:{style:{maxHeight:400,width:200}}},children:[e.jsx(m,{disabled:!0,value:"",children:e.jsx(e.Fragment,{children:"Estados"})}),O.map((r,o)=>e.jsxs(m,{value:String(r.value),children:[e.jsx(Z,{checked:u.includes(String(r.value))}),e.jsx(N,{primary:r.name})]},o))]})]}),e.jsxs(c,{spacing:1,width:200,direction:"row",alignItems:"center",children:[e.jsx(_,{htmlFor:"priority_select",sx:{display:"none"},children:"Prioridad"}),e.jsxs(I,{displayEmpty:!0,value:p??"",onChange:H,inputProps:{id:"priority_select"},renderValue:r=>{if(r.length===0)return e.jsx(e.Fragment,{children:"Nivel de prioridad"});const o=z.find(v=>String(v.value)===String(r));return e.jsx(e.Fragment,{children:o?o.name:"No controlado"})},IconComponent:({...r})=>p?e.jsx(P,{onClick:o=>{o.stopPropagation(),i(h({priority:void 0}))}}):e.jsx(D,{...r}),sx:{width:200,borderRadius:"10px",backgroundColor:"transparent","&.Mui-focused":{boxShadow:"none"},"&.MuiOutlinedInput-root":{fontWeight:500,backgroundColor:"transparent",color:"text.primary","& fieldset":{...p&&{backgroundColor:"tertiary.opacityLight"},borderColor:"custom.outlineBoder"},"&:hover fieldset":{backgroundColor:"tertiary.opacityLight",borderColor:"custom.outlineBoder"},"&.Mui-focused fieldset":{borderColor:"custom.outlineBoder",backgroundColor:"tertiary.opacityLight"}},"& .MuiSelect-icon":{color:"text.primary"}},MenuProps:{PaperProps:{style:{maxHeight:200,width:200}}},children:[e.jsx(m,{disabled:!0,value:"",children:e.jsx(e.Fragment,{children:"Nivel de prioridad"})}),z.map((r,o)=>e.jsx(m,{value:r.value,children:r.name},o))]})]}),e.jsxs(c,{spacing:1,width:200,direction:"row",alignItems:"center",children:[e.jsx(_,{htmlFor:"date-select-ticket",sx:{display:"none"},children:"Fecha"}),e.jsx(q,{format:"DD/MM/YYYY",value:a?L(a,"DD/MM/YYYY"):null,onChange:r=>{r&&i(h({date:r.format("DD/MM/YYYY")}))},slots:{inputAdornment:Se},slotProps:{textField:{size:"medium",id:"date-select-ticket"},inputAdornment:{canDelete:!!a}}})]})]}),e.jsx(V,{variant:"contained",color:"primary",size:"medium",startIcon:e.jsx(ee,{}),onClick:k,sx:{minWidth:140,whiteSpace:"nowrap"},children:"Crear ticket"})]})})})})};function Se(i){const{canDelete:t,children:d,sx:a,...u}=i,p=W();return e.jsxs(re,{...u,children:[t&&e.jsx(P,{onClick:x=>{x.stopPropagation(),p(h({date:void 0}))}}),!t&&d]})}const we=({controlador:{ctrl_id:i}})=>{const[t,d]=b.useState(0),[a,u]=b.useState(10),{date:p,states:x,priority:f}=B(g=>g.ticketStore),n=g=>{u(g.target.value),d(0)},s=(g,T)=>{d(T)},[w,{isError:F,isSuccess:M,data:k}]=ne();return b.useEffect(()=>{const g={};x.length>0&&(g.state=x),p!==void 0&&(g.dateRange={end:L(p,"DD/MM/YYYY").format("YYYY-MM-DD"),start:L(p,"DD/MM/YYYY").format("YYYY-MM-DD")}),f!==void 0&&(g.priority=f),w({ctrl_id:i,limit:a,offset:t*a,filters:g},!1)},[i,t,a,p,f,x]),e.jsxs(e.Fragment,{children:[e.jsx(ae,{component:ve,children:e.jsxs(se,{"aria-label":"simple table",size:"small",sx:g=>({"& .MuiTableCell-root":{borderColor:"divider"},"& tbody tr:hover":{backgroundColor:"tertiary.opacityLight"}}),children:[e.jsx(de,{sx:{backgroundColor:"action.hover"},children:e.jsxs(le,{children:[e.jsx(j,{children:"N°"}),e.jsx(j,{children:"Empresa"}),e.jsx(j,{children:"Descripción"}),e.jsx(j,{children:"Ingreso"}),e.jsx(j,{children:"Salida"}),e.jsx(j,{children:"Estado"}),e.jsx(j,{children:"Decisión"})]})}),e.jsx(ce,{children:M&&k&&k.data.map(g=>e.jsx(ue,{ctrl_id:i,registroTicket:g},g.rt_id))})]})}),M&&k&&e.jsx(pe,{handleChangePage:s,handleChangeRowsPerPage:n,page:t,rowsPerPage:a,total:k.total_size})]})},ve=oe(ie)(({theme:i})=>({borderTopRightRadius:0,borderTopLeftRadius:0,border:"none",backgroundColor:i.palette.background.default,backgroundImage:"none",boxShadow:"none"})),_e=[{state:l.Esperando,name:"Pendiente",backgroundColor:"warning.300",filter:"drop-shadow(0px 2px 6px rgba(241, 225, 44, 0.30))"},{state:l.Aceptado,name:"Aceptado",backgroundColor:"success.opacityDarker",filter:"drop-shadow(0px 2px 6px rgba(44, 241, 120, 0.30))"},{state:l.Cancelado,name:"Cancelado",backgroundColor:"secondary.400",filter:"drop-shadow(0px 2px 6px rgba(242, 160, 44, 0.30))"},{state:l.Rechazado,name:"Rechazado",backgroundColor:"error.opacityDarker",filter:"drop-shadow(0px 2px 6px rgba(241, 44, 44, 0.30))"},{state:l.Finalizado,name:"Finalizado",backgroundColor:"info.opacityDarker",filter:"drop-shadow(0px 2px 6px rgba(44, 113, 241, 0.30))"},{state:l.Anulado,name:"Anulado",backgroundColor:"tertiary.opacityDarker",filter:"drop-shadow(0px 2px 6px rgba(93, 115, 117, 0.30))"},{state:l.NoAtendido,name:"No atendido",backgroundColor:"action.disabledBackground",filter:"drop-shadow(0px 1px 6px rgba(42, 55, 60, 0.10))"},{state:l.Asistido,name:"Asistió",backgroundColor:"primary.300",filter:"drop-shadow(0px 2px 6px rgba(44, 225, 241, 0.30))"},{state:l.Inasistencia,name:"No asistió",backgroundColor:"tertiary.opacityDarker",filter:"drop-shadow(0px 2px 6px rgba(93, 115, 117, 0.30))"}],y=({state:i})=>{const t=_e.find(d=>d.state===i);return e.jsxs(c,{direction:"row",spacing:1,alignItems:"center",children:[e.jsx(C,{sx:{width:12,height:12,backgroundColor:(t==null?void 0:t.backgroundColor)??"tertiary.opacityDarker",borderRadius:"50%",filter:(t==null?void 0:t.filter)??"drop-shadow(0px 2px 6px rgba(93, 115, 117, 0.30))",strokeWidth:1,stroke:"divider"}}),e.jsx(Y,{color:"textSecondary",variant:"body1",children:(t==null?void 0:t.name)??"error_estado"})]})},Pe=()=>{const{rgn_id:i,ctrl_id:t}=B(n=>n.ticketStore),{isSuccess:d,data:a}=G(),[u,p]=b.useState(0),x=b.useMemo(()=>a===void 0?{}:S(a,"rgn_id"),[a]),f=b.useMemo(()=>{if(!a)return[];let n=a;return i!==void 0?n=n.filter(s=>String(s.rgn_id)===String(i)):u>0&&(n=n.filter(s=>String(s.rgn_id)===String(u))),t!==void 0&&(n=n.filter(s=>String(s.ctrl_id)===String(t))),n},[a,i,t,u]);return b.useEffect(()=>{if(d&&a&&i===void 0){const n=a[0].rgn_id;n&&p(n)}},[d,a,i]),e.jsxs(c,{spacing:2,height:"100%",children:[e.jsx(C,{children:e.jsx(R,{sx:{maxWidth:"100%",height:"100%"},children:e.jsx(c,{direction:"row",spacing:2,paddingBottom:1.5,children:Object.entries(x).map(([n,s])=>e.jsx(Me,{region:s[0].region,selected:i!==void 0?String(i)===String(n):String(n)===String(u),onClick:()=>{p(Number(n))}},n))})})}),e.jsxs(c,{flexGrow:1,overflow:"hidden",sx:{borderWidth:1,borderStyle:"solid",borderColor:"divider",borderRadius:"8px"},children:[e.jsx(R,{sx:{height:"100%",width:"100%"},children:e.jsx(ge,{disablePadding:!0,children:f.map((n,s,w)=>e.jsx(Ie,{title:n.nodo,divider:s<w.length-1,children:e.jsx(we,{controlador:n})},`${n.rgn_id}_${n.ctrl_id}`))})}),e.jsxs(c,{direction:"row",spacing:1,px:2,py:1,alignItems:"center",sx:{backgroundColor:"action.hover"},children:[e.jsx(y,{state:l.Esperando}),e.jsx(y,{state:l.Aceptado}),e.jsx(y,{state:l.Rechazado}),e.jsx(y,{state:l.Inasistencia}),e.jsx(y,{state:l.Finalizado}),e.jsx(y,{state:l.Cancelado}),e.jsx(y,{state:l.NoAtendido})]})]})]})},Me=({region:i,selected:t,onClick:d})=>e.jsx(C,{sx:{py:1,px:2,borderRadius:"10px",border:"1px solid",borderColor:"custom.outlineBoder",":hover":{...t&&{backgroundColor:"primary.opacityDark"},...!t&&{backgroundColor:"primary.opacityLight"}},...t&&{backgroundColor:"primary.opacityDark",borderColor:"transparent"},cursor:"pointer"},onClick:d,children:e.jsx(Y,{variant:"subtitle1",color:"textPrimary",sx:{whiteSpace:"nowrap"},children:i.region})}),Ie=({children:i,title:t,divider:d})=>{const[a,u]=b.useState(!1),p=()=>{u(!a)};return e.jsxs(e.Fragment,{children:[e.jsxs(Ce,{onClick:p,sx:{backgroundColor:"tertiary.opacityMain",color:"text.primary",":hover":{color:"text.primary",backgroundColor:a?"tertiary.opacityMain":"custom.trackBackground"}},divider:d,children:[e.jsx(N,{primary:t,slotProps:{primary:{variant:"subtitle1"}}}),a?e.jsx(fe,{}):e.jsx(je,{})]}),e.jsx(ye,{in:a,timeout:"auto",unmountOnExit:!0,sx:{...a&&{borderBottomWidth:1,borderBottomStyle:"solid",borderBottomColor:"divider"}},children:i})]})},Ee=()=>e.jsx(C,{sx:{width:"100%",height:"100%",overflow:"hidden"},children:e.jsxs(c,{sx:{px:{xs:2,sm:3},py:{xs:2,sm:3},mx:"auto",overflow:"hidden"},spacing:2,maxWidth:1600,width:"100%",height:"100%",children:[e.jsx(c,{children:e.jsx(Y,{variant:"h5",children:"Tickets"})}),e.jsx(ke,{}),e.jsx(he,{}),e.jsx(c,{flexGrow:1,overflow:"hidden",children:e.jsx(Pe,{})})]})});export{Ee as default};
